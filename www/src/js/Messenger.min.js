function scan_card_by_id(e){var t=Messenger.finance.cards;for(var a in t)if(t[a].card_id==e)return t[a]}function secure(e,t,a,n){API("get_user_security_info",{target:n},!1,function(n){if("success"!=n.status)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Ошибка"),type:"error",confirmButtonText:_chat_e("Ok"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!1,text:_chat_e("Не удалось получить настройки безопасности для определненния типа  поддтверждения")});var s="",r="loan_api_check";"one_pass"==n.security_type&&(s=_chat_e("Введите код номер:")+" <strong>"+n.security_code_num+"</strong> "+_chat_e("из таблици кодов:")+' <strong style="font-size: 10px;">'+n.security_code_table_num+"</strong>"),"code"==n.security_type&&(s=_chat_e("Введите код из приложения")+" <strong>Webtransfer Auth</strong>"),"otp"==n.security_type&&(s=_chat_e("Введите код из ")+" <strong>Google Auth</strong>",r="otp"),"email"==n.security_type&&(s=_chat_e("Ваш код отправлен вам на почту: ")+" <strong>"+MyProfile.email+"</strong>"),swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Подтвердить"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,text:'<div class="mv-area code-area-sec"><img class="img-main-section mx-wth-area" src="./src/img/user-s.png" onerror="this.src=\'../../.\'+this.src;this.onerror = null;"><form action="#" onsubmit="return false;"><div class="select-form"><label>'+s+'</label><input class="form-control" placeholder="'+_chat_e("Ваш код")+'" id="code_user_secure" autocomplete="off"></div></form><p class="spls-p">'+e+"</p><br></div>"}).then(function(e){t&&t({code:$("#code_user_secure").val(),type:r,success:!0})},function(){a&&a()})},!0)}window.__cards_storage=!1,window.__wallet_storage=!1;try{window.__cards_storage=JSON.parse(localStorage.getItem("cards")),window.__wallet_storage=JSON.parse(localStorage.getItem("wallet"))}catch(e){console.warn("JSON warn localStorage:",e)}var Messenger={event:{},page:null,on:function(e,t){Messenger.event[e]=t},setNotificationsCount:function(e,t){if("+"==e&&(!0,e=ractiveComponent.rootApp.get("notificationCount")+1),0==e||null==e)return!1;ractiveComponent.rootApp.set("notificationCount",e),e=0==e?"":(+e).toString(),gui&&win&&win_gui.setBadgeLabel(e)},setPage:function(e,t,a){ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].unrender();var n=e.split(":");e=n[0],console.log("setPage:",e,n[1],t),n[1]&&(t=n[1]),n[2]&&(t=n[1]),Messenger.chat.openChat=null,$("nav#menu").data("mmenu").close(),ractiveComponent.rootApp.set("pageActive","contentApplication"),"chats"==e&&requireElement({name:"Dialogs",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}}),"contacts"==e&&requireElement({name:"Contacts",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&(ractiveComponent[Messenger.page].render(),ractiveComponent["wtc-ContactsApp"].set("tab",t))}}),"debitcoin"==e&&requireElement({name:"Debitcoin",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){t||(t="gold"),e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&(ractiveComponent[Messenger.page].render(),t&&ractiveComponent["wtc-DebitcoinApp"].set("tab",t))}}),"deposits"==e&&requireElement({name:"Deposits",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&(ractiveComponent[Messenger.page].render(),t&&ractiveComponent["wtc-DepositsApp"].set("tab",t))}}),"bonus"==e&&requireElement({name:"Bonus",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&(ractiveComponent[Messenger.page].render(),t&&(bonus_tab=t,ractiveComponent["wtc-BonusApp"].set("tab",t)))}}),"legal"==e&&requireElement({name:"Legal",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&(ractiveComponent[Messenger.page].render(),t&&ractiveComponent["wtc-LegalApp"].set("tab",t))}}),"profile"==e&&requireElement({name:"Profile",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}}),"dialog"==e&&requireElement({name:"Chat",ver:"1.1.0",element:"#chat-content_message"}),"cards"==e&&requireElement({name:"Cards",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}}),"topup"==e&&requireElement({name:"Topup",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render(),ractiveComponent[Messenger.page].set("select_card",t)}}),"order"==e&&(n[1]&&(Messenger.body.order_card.tabPage=n[1]),Messenger.body.order_card.tabPage||(Messenger.body.order_card.tabPage="virtual"),Messenger.body.order_card.callback&&Messenger.body.order_card.callback(),requireElement({name:"Order",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}})),"guarantee"==e&&(n[1]&&(Messenger.body.guarantee.tabPage=n[1]),Messenger.body.guarantee.tabPage||(Messenger.body.guarantee.tabPage="create"),Messenger.body.guarantee.callback&&Messenger.body.guarantee.callback(),requireElement({name:"Guarantee",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}})),"affiliates"==e&&(n[1]&&(Messenger.body.Affiliates.tabPage=n[1]),Messenger.body.Affiliates.tabPage||(Messenger.body.Affiliates.tabPage="about"),Messenger.body.Affiliates.callback&&Messenger.body.Affiliates.callback(),requireElement({name:"Affiliates",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}})),"sendmoney"==e&&requireElement({name:"Sendmoney",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}}),"Chatinfo"==e&&(ractiveComponent.rootApp.set("pageActive","contentApplication_more"),requireElement({name:"Chat_info",ver:"1.1.0",element:"#contentApplication_more"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}}),$("#contentApplication_more").animateCss("slideInDown")),"settings"==e&&(Messenger.body.settings.tabPage=n[1],Messenger.body.settings.callback&&Messenger.body.settings.callback(),requireElement({name:"Settings",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render(),ractiveComponent["wtc-SettingsApp"].set("tabPage",Messenger.body.settings.tabPage)}}),ractiveComponent["wtc-SettingsApp"],ractiveComponent.rootApp.set("tabPage",Messenger.body.settings.tabPage)),"ProfileEdit"==e&&requireElement({name:"ProfileEdit",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render(),ractiveComponent["wtc-ProfileEditApp"].set("tab",t),console.error("err",t)}}),"credit"==e&&(n[1]&&(Messenger.body.credit.tabPage=n[1]),Messenger.body.credit.tabPage||(Messenger.body.credit.tabPage="loans"),Messenger.body.credit.callback&&Messenger.body.credit.callback(),requireElement({name:"Credit",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}})),"info_card"==e&&requireElement({name:"Info_card",ver:"1.1.0",element:"#contentApplication"},{cnt:0,afterlast:function(e){e&&(e+="App"),Messenger.page=e,ractiveComponent&&Messenger.page&&ractiveComponent[Messenger.page]&&!ractiveComponent[Messenger.page].fragment.rendered&&ractiveComponent[Messenger.page].render()}}),a||history.pushState({},"Telegraf Money","#"+e+"-"+t),ractiveComponent.rootApp.set("page",e)},MyProfileUpdate:function(){for(var e in ractiveComponent)ractiveComponent[e].set("MyProfile",MyProfile);localStorage.setItem("MyProfile",JSON.stringify(MyProfile))},body:{order_card:{},settings:{},credit:{},guarantee:{},Affiliates:{}},finance:{cards:window.__cards_storage,cards_all:[],callback_cnt:0,microinvests:[],data:{wallet:window.__wallet_storage},update_wait:!1,update:function(){MyProfile?API("get_finance_data_this_user",{},!1,function(e){var t=[];for(var a in e.cards){if(e.cards.hasOwnProperty(a))for(var n in e.cards[a].demand)e.cards[a].demand.hasOwnProperty(n)&&(e.cards[a].demand[n].card={card_currency:e.cards[a].card_currency,card_id:e.cards[a].card_id,card_name:e.cards[a].card_name,card_name_short:e.cards[a].card_name_short,card_type:e.cards[a].card_type,id:e.cards[a].id,last_balance:e.cards[a].last_balance,name_on_card:e.cards[a].name_on_card,send_money_limit:e.cards[a].send_money_limit});t=t.concat(e.cards[a].demand);var s=0,r=0,o=0;for(var i in e.cards[a].demand)s+=+e.cards[a].demand[i].summa,r+=+e.cards[a].demand[i].current_income,o+=+e.cards[a].demand[i].summa+e.cards[a].demand[i].current_income;e.cards[a].invest_ammount=+s.toFixed(2),e.card_start_balanses[e.cards[a].card_id]?e.cards[a].card_start_balanses=+e.card_start_balanses[e.cards[a].card_id]:e.cards[a].card_start_balanses=0,e.cards[a].profit_ammount=+r.toFixed(2),e.cards[a].demand_ammount=+o.toFixed(2),e.cards[a].total_balance=+(e.cards[a].demand_ammount+e.cards[a].last_balance).toFixed(2)}for(var n in t)Messenger.finance.microinvests=t;Messenger.finance.data=e,Messenger.finance.cards=e.cards;for(var n in Messenger.finance.cb_function_arr)Messenger.finance.cb_function_arr[n](Messenger.finance.cards,Messenger.finance.microinvests,!1,Messenger.finance.data);localStorage.setItem("cards",JSON.stringify(Messenger.finance.cards)),localStorage.setItem("wallet",JSON.stringify(Messenger.finance.data.wallet)),API("get_cards_info",{},function(e){Messenger.finance.cards_all=e.cards.wtcards_list;for(var t in Messenger.finance.cb_function_arr)Messenger.finance.cb_function_arr[t](Messenger.finance.cards,Messenger.finance.microinvests,Messenger.finance.cards_all,Messenger.finance.data)}),Messenger.finance.update_at=new Date},!0):Messenger.finance.update_wait=!0},cb_function_arr:[],callback_save:function(e){Messenger.auth_action.call_wait_auth(function(){if(Messenger.finance.cb_function_arr.push(e),Messenger.finance.cb_function_arr.length<=1){try{e(JSON.parse(localStorage.getItem("cards")))}catch(e){console.error(e)}Messenger.finance.update()}else Messenger.finance.update_at||Messenger.finance.update(),e(Messenger.finance.cards,Messenger.finance.microinvests,Messenger.finance.cards_all,Messenger.finance.data)})},update_at:null},guarantee:{data:[],update_wait:!1,update:function(){MyProfile?API("getOrdersData",{mode:"all",bonus:9},function(e){Messenger.guarantee.data=e.orders;for(var t in Messenger.guarantee.cb_function_arr)Messenger.guarantee.cb_function_arr[t](Messenger.guarantee.data);Messenger.guarantee.update_at=new Date}):Messenger.guarantee.update_wait=!0},cb_function_arr:[],callback_save:function(e){Messenger.guarantee.cb_function_arr.push(e),Messenger.guarantee.cb_function_arr.length<=1?Messenger.guarantee.update():e(Messenger.guarantee.data)},update_at:null},chat:{data:[],threads:{},scrollLoad:!0,openChat:null,read:!0,openChat_param_type:null,page:0,callback:!1,callback_save:function(e){this.callback=e,this.callback&&this.callback()},message:function(e){var t=_find(Messenger.threads.data,"id",e.threads_id._id),a=!0,n={group_name:e.threads_id.group_name,id:e.threads_id._id,last_message:e.threads_id.last_message.message,last_message_messageId:e.threads_id.last_message.messageId,last_message_read:e.threads_id.last_message.read,last_message_sender_id:e.threads_id.last_message.sender,unread_count_this_thread:e.threads_id.unread_count_this_thread,last_online_text:"Invalid date",online:0,spam:!1,type_threads:e.threads_id.type,updated_at:e.threads_id.update_at};if(n.my_id=MyProfile.webtransfer_id,e.sender.webtransfer_id!=MyProfile.webtransfer_id&&(n.avatar_path=e.sender.avatar_path,n.webtransfer_id=e.sender.webtransfer_id,n.name_short=e.sender.name_short,n.last_online_at=e.sender.last_online_at,n.full_name=e.sender.name_first+" "+e.sender.name_last),null!=n.updated_at){var s=n.updated_at.split("T")[0],r=moment(n.updated_at,moment.ISO_8601);moment().format("YYYY-MM-DD")==s?n.updated_at_text=r.format("HH:mm"):moment().subtract(r.day(),"day").hours(0).minutes(0).second(0)<=r&&6!=r.day()?n.updated_at_text=r.format("ddd"):n.updated_at_text=r.format("DD.MM.YY"),n.last_message&&""!=n.last_message?n.last_message=n.last_message.replace(/<\/?[^>]+>/g,""):n.last_message="...","https://webtransfer.com/assets/missing_avatar_thumb.jpeg"==n.avatar_path&&(n.avatar_path=!1)}if(!1!==t)for(var o in n)n.hasOwnProperty(o)&&(Messenger.threads.data[t][o]=n[o]);else if(n.webtransfer_id)Messenger.threads.data.push(n);else for(var i in e.threads_id.users)e.threads_id.users[i].webtransfer_id!=MyProfile.webtransfer_id&&API("userInfo",{webtransfer_id:e.threads_id.users[i].webtransfer_id},function(e){n.avatar_path=e.user.avatar_path,n.webtransfer_id=e.user.webtransfer_id,n.name_short=e.user.name_short,n.last_online_at=e.user.last_online_at,n.full_name=e.user.name_first+" "+e.user.name_last,Messenger.threads.data.unshift(n)},!0);Messenger.threads.update();var c=!1;if(e.threads_id.users.forEach(function(t){t.webtransfer_id==Messenger.chat.openChat&&(c=!0,Messenger.chat.open(e.threads_id._id,"threads_id"))}),!c&&"threads_id"==Messenger.chat.openChat_param_type&&e.threads_id._id==Messenger.chat.openChat){if(e.message){var d=e.message.split("###");console.log(d);for(var g in d)d.hasOwnProperty(g)&&d[g]===_chat_e("lang_name")&&(e.message=d[g+1])}var l=moment(e.update_at,moment.ISO_8601);if(e.updated_at_time=l.format("HH:mm"),e.updated_at_date=l.format("DD.MM.YYYY"),e.sender.webtransfer_id!=MyProfile.webtransfer_id)Messenger.setNotificationsCount(null,!0),a=!1,Messenger.chat.data.push(e);else{a=!1;for(var p=!1,_=0,m=Messenger.chat.data.length;_<m;_++)Messenger.chat.data[_].message_hesh==e.message_hesh&&(Messenger.chat.data[_]=e,p=!0);p||Messenger.chat.data.push(e)}if($("#contentMessageScroll").nanoScroller(),Messenger.chat.callback&&Messenger.chat.callback(),Messenger.chat.prcScroll>95){var u={};u[Messenger.chat.openChat_param_type]=Messenger.chat.openChat,API("thread_read",u),Messenger.threads.data.forEach(function(e,t){e.id==Messenger.chat.openChat&&(Messenger.threads.data[t].unread_count_this_thread=0)}),Messenger.threads.update(),$("#contentMessageScroll").nanoScroller().nanoScroller({scroll:"bottom"})}else Messenger.chat.read=!1}!0===a&&Messenger.setNotificationsCount("+",!0)},send:function(e,t){if("console_help"==e)return noty({text:"console1531 (showDevTools),consoleMyProfile (show var MyProfile)",type:"information",theme:"metroui",layout:"topCenter",timeout:1e4,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),window.nw&&(a=nw.Window.get()).showDevTools(),ractiveComponent.rootApp.set("send_wait",!1),send_wait=!1,!1;if("console1531"==e){if(noty({text:_chat_e("Developer cmd init..."),type:"information",theme:"metroui",layout:"topCenter",timeout:2e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),window.nw){var a=nw.Window.get();a.showDevTools()}return ractiveComponent.rootApp.set("send_wait",!1),send_wait=!1,!1}if("consoleMyProfile"==e)return Messenger.chat.data.push({message:JSON.stringify(MyProfile),wait:!0,error:!0,message_hesh:"dev",sender:MyProfile}),$("#contentMessageScroll").nanoScroller().nanoScroller({scroll:"bottom"}),ractiveComponent.rootApp.set("send_wait",!1),send_wait=!1,!1;if("console_connect_param"==e)return Messenger.chat.data.push({message:JSON.stringify(paramSocket),wait:!0,error:!0,message_hesh:"dev",sender:MyProfile}),$("#contentMessageScroll").nanoScroller().nanoScroller({scroll:"bottom"}),ractiveComponent.rootApp.set("send_wait",!1),send_wait=!1,!1;var n={message:e,message_hesh:guid()};n[Messenger.chat.openChat_param_type]=this.openChat,t&&(n.message_attach=t),Messenger.chat.data.push({message:e,wait:!0,message_hesh:n.message_hesh,sender:MyProfile}),Messenger.chat.callback&&Messenger.chat.callback();var s={};s[Messenger.chat.openChat_param_type]=Messenger.chat.openChat,API("thread_read",s),Messenger.threads.data.forEach(function(e,t){e.id==Messenger.chat.openChat&&(Messenger.threads.data[t].unread_count_this_thread=0)}),Messenger.threads.update(),$("#contentMessageScroll").nanoScroller().nanoScroller({scroll:"bottom"}),setTimeout(function(){ractiveComponent.rootApp.set("send_wait",!1),send_wait=!1},10),API("create_message",n,function(e){if(ractiveComponent.rootApp.set("send_wait",!1),send_wait=!1,e.error){"access"==e.error?noty({text:_chat_e("Вам ограничен доступ в данном чате!"),type:"error",theme:"metroui",layout:"topCenter",timeout:3e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}):noty({text:_chat_e("Ошибка сообшение не отправленно причина:")+e.error,type:"error",theme:"metroui",layout:"topCenter",timeout:3e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}});for(var t=0,a=Messenger.chat.data.length;t<a;t++)Messenger.chat.data[t].message_hesh==e.message_hesh&&(Messenger.chat.data[t].error=!0,Messenger.chat.callback&&Messenger.chat.callback())}Messenger.chat.prcScroll=100})},getHistory:function(e){var t={page:++Messenger.chat.page};t[Messenger.chat.openChat_param_type]=Messenger.chat.openChat,API("get_messages",t,!1,function(t){if(t&&t.threads||(Messenger.chat.data=[]),t.threads&&"group"==t.threads.type){var a={avatar_path:!1|t.threads.avatar_path,count_reviews:0|t.threads.count_reviews,full_name:t.threads.full_name,group_name:t.threads.group_name,group_photo:t.threads.group_photo,group_verefy:t.threads.group_verefy,id:t.threads._id,last_message:t.threads.last_message.message,last_message_messageId:t.threads.last_message.messageId,last_message_read:t.threads.last_message.read,last_message_sender_id:t.threads.last_message.sender,last_online:"Invalid date",last_online_at:!1,my_id:MyProfile.webtransfer_id,name_short:"SL",rating:0,spam:!1,type_threads:t.threads.type,unread_count_this_thread:0,updated_at:t.threads.update_at,updated_at_text:null,user_count:t.threads.user_count,users:t.threads.users,webtransfer_id:null};ractiveComponent.rootApp.set("open_threads",a),Messenger.threads.open=a}Messenger.chat.threads=t.threads;for(var n in t.messages){if(t.messages[n].updated_at_time=moment(t.messages[n].update_at,moment.ISO_8601).format("HH:mm"),t.messages[n].updated_at_date=moment(t.messages[n].update_at,moment.ISO_8601).format("DD.MM.YYYY"),t.messages[n].message){console.log(t.messages[n].message);var s=t.messages[n].message.split("###"+_chat_e("lang_name")+"###");for(var r in s)s.hasOwnProperty(r)&&(s[1]?t.messages[n].message=s[1]:t.messages[n].message=s[0])}Messenger.chat.data.unshift(t.messages[n])}if(1==Messenger.chat.page&&(Messenger.chat.prcScroll=100),Messenger.chat.callback&&Messenger.chat.callback(),$("#contentMessageScroll").nanoScroller(),Messenger.chat.prcScroll>95){var o={};o[Messenger.chat.openChat_param_type]=Messenger.chat.openChat,API("thread_read",o),Messenger.threads.data.forEach(function(e,t){e.id==Messenger.chat.openChat&&(Messenger.threads.data[t].unread_count_this_thread=0)}),Messenger.threads.update(),setTimeout(function(){$("#contentMessageScroll").nanoScroller().nanoScroller({scroll:"bottom"})},100)}0==t.messages.length&&ractiveComponent["wtc-ChatApp"].set("messages_more",!1),e&&e()})},read_this_chat:function(e){if(e._id==Messenger.chat.openChat||e.webtransfer_id==Messenger.chat.openChat)for(var t in Messenger.chat.data)Messenger.chat.data.hasOwnProperty(t)&&(Messenger.chat.data[t].read_at=(new Date).toString());setTimeout(function(){Messenger.chat.callback&&Messenger.chat.callback()},10)},open:function(e,t){Messenger.chat.openChat=e,Messenger.chat.openChat_param_type=t,Messenger.chat.scrollLoad=!0,Messenger.chat.data=[],Messenger.chat.callback&&Messenger.chat.callback(),ractiveComponent["wtc-ChatApp"]&&ractiveComponent["wtc-ChatApp"].set("messages_load",!1),Messenger.chat.page=0,Messenger.chat.getHistory(),document.getElementById("send_text").focus(),window.pos_caret=save_pos_caret()},prcScroll:100,lastElement:null,onscroll:function(e){if(Messenger.chat.pos=e.maximum-e.position,e.maximum-e.position<50?Messenger.chat.prcScroll=100:Messenger.chat.prcScroll=50,100==Messenger.chat.prcScroll&&!Messenger.chat.read){var t={};t[Messenger.chat.openChat_param_type]=Messenger.chat.openChat,API("thread_read",t),Messenger.threads.update()}}},partners:{data:[],update:function(){API("contacts",{page:"all"},!1,function(e){e.contacts.forEach(function(e){e.last_online=moment(e.online_date,moment.ISO_8601).fromNow()}),Messenger.partners.data=e.contacts;for(var t in Messenger.partners.cb_function_arr)Messenger.partners.cb_function_arr[t](Messenger.partners.data)})},cb_function_arr:[],callback_save:function(e){Messenger.partners.cb_function_arr.push(e),0==Messenger.partners.data.length?Messenger.partners.update():e(Messenger.partners.data)}},friends:{data:[],update:function(){API("getFriends",{page:"all"},!1,function(e){Messenger.friends.data=e.friends.map(function(e){return e.friend.info.last_online=moment(e.friend.info.last_online_at,moment.ISO_8601).fromNow(),e.friend.info.full_name=e.friend.info.name_first+" "+e.friend.info.name_last,e.friend.info});for(var t in Messenger.friends.cb_function_arr)Messenger.friends.cb_function_arr[t](Messenger.friends.data)})},cb_function_arr:[],callback_save:function(e){Messenger.friends.cb_function_arr.push(e),0==Messenger.friends.data.length?Messenger.friends.update():e(Messenger.friends.data)}},threads:{scrollLoad:!0,data:[],page:1,finish:!1,update:function(e,t){function a(e,t){return moment(e.updated_at,moment.ISO_8601)<moment(t.updated_at,moment.ISO_8601)?1:moment(e.updated_at,moment.ISO_8601)>moment(t.updated_at,moment.ISO_8601)?-1:0}if(0==Messenger.threads.data.length&&(Messenger.threads.data=[],Messenger.threads.page=1,e=!0),e&&!Messenger.threads.finish)return API("get_threads",{page:Messenger.threads.page},!1,function(e){e.threads.length>=30?Messenger.threads.finish=!1:Messenger.threads.finish=!0,e.threads.forEach(function(e){var t=_find(Messenger.threads.data,"id",e.id);if(null!=e.updated_at){var a=e.updated_at.split("T")[0],n=moment(e.updated_at,moment.ISO_8601);if(moment().format("YYYY-MM-DD")==a?e.updated_at_text=n.format("HH:mm"):moment().subtract(n.day(),"day").hours(0).minutes(0).second(0)<=n&&6!=n.day()?e.updated_at_text=n.format("ddd"):e.updated_at_text=n.format("DD.MM.YY"),e.last_message&&(e.last_message=e.last_message.replace(/<\/?[^>]+>/g,"")),e.avatar_path&&(e.avatar_path=e.avatar_path.replace("http://","https://")),"https://webtransfer.com/assets/missing_avatar_thumb.jpeg"==e.avatar_path&&(e.avatar_path=!1),e.last_message){var s=e.last_message.split("###"+_chat_e("lang_name")+"###");for(var r in s)s.hasOwnProperty(r)&&(s[1]?e.last_message=s[1]:e.last_message=s[0])}e.my_id=MyProfile.webtransfer_id,!1!==t?Messenger.threads.data[t]=e:Messenger.threads.data.push(e)}}),Messenger.threads.update(),Messenger.threads.page++,Messenger.threads.scrollLoad=!0}),!1;t||Messenger.threads.data.sort(a);for(var n in Messenger.threads.cb_function_arr)Messenger.threads.cb_function_arr[n](Messenger.threads.data)},cb_function_arr:{},callback_save:function(e,t){Messenger.threads.cb_function_arr[e]=t,0==Messenger.threads.data.length?Messenger.threads.update():t(Messenger.threads.data)}},auth_action:{status:!1,cb_function_arr:[],call_wait_auth:function(e){Messenger.auth_action.status?e():Messenger.auth_action.cb_function_arr.push(e)},auth_emit:function(){if(!Messenger.auth_action.status){Messenger.auth_action.status=!0;for(var e in Messenger.auth_action.cb_function_arr)Messenger.auth_action.cb_function_arr[e]();Messenger.auth_action.cb_function_arr=[]}},FingerprintAuth:function(e,t,a){console.log(" FingerprintAuth testing..."),window.touchid||a&&a({error:"Auth error",code:404,ios:!1,android:!1}),MyProfile.secure_touch_id||a&&a({error:"Auth error",code:429,ios:!1,android:!1}),touchid.checkSupport(function(){console.log("touchid available: "+e),touchid.authenticate(function(){t&&t({ios:!0})},function(){a&&a({error:"Auth error",code:403,ios:"touch id authenticate error",android:!1})},e)},function(){FingerprintAuth.isAvailable(function(n){if(console.log("FingerprintAuth available: "+e),n.isAvailable){var s={clientId:"com.telegraf.money",username:"currentUser",password:"currentUserPassword",dialogTitle:_chat_e("Подтверждения действия"),dialogMessage:e};FingerprintAuth.encrypt(s,function(e){e.withFingerprint?t&&t(e):e.withBackup&&a&&a({error:"Auth error",code:403,ios:!1,android:"FingerprintAuth password error"})},function(e){"Cancelled"===e?a&&a({error:"Auth error",code:403,ios:!1,android:"FingerprintAuth Cancelled"}):a&&a({error:"Auth error",code:403,ios:!1,android:"FingerprintAuth error: "+e})})}else a&&a({error:"Auth error",code:403,ios:!1,android:"FingerprintAuth error"})},function(e){a&&a({error:"Not found fingerprint",code:404,ios:"checkSupport: false",android:e})})})}},auth:function(e){if(e.status&&"success"==e.status){if(clearTimeout(auth_timeout),MyProfile=e.user,Messenger.MyProfileUpdate(),Messenger.auth_action.auth_emit(),param_url_this().openDialog)Messenger.openChat(!1,param_url_this().openDialog);else if(param_url_this().default_page){var t=param_url_this().default_page.split(":");"chat"==t[0]&&("threads_id"==t[1]&&Messenger.openChat(!1,!1,t[2]),"recipient_id"==t[1]&&Messenger.openChat(!1,t[2]))}API("countUnreadMessage",{},!1,function(e){Messenger.setNotificationsCount(e.count)}),Messenger.finance.callback_save(function(e){ractiveComponent.rootApp.set("finance_cards",e),e&&0==e.length&&Messenger.finance.callback_cnt>=1&&Messenger.finance.callback_cnt<100&&(Messenger.finance.callback_cnt=101,Messenger.setPage("cards")),Messenger.finance.callback_cnt++,ractiveComponent.rootApp.set("finance_cards_load",!0)}),Messenger.finance.update_wait&&Messenger.finance.update(),"see"!=localStorage.getItem("post1")&&(new Date("2017-04-25 23:44:17").getTime()>(new Date).getTime()&&swal({customClass:"swal-telegraf-modal select-form text-rg",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:"",type:"",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,html:'<img src="https://s3-us-west-2.amazonaws.com//telegraf-ava/avatar/10989451.png" style="     position: relative;     width: 21px; "><span class="fcg" style=" ">   <span class="fwb"><a class="pointer">Telegraf Money</a></span>   '+_chat_e("поделился(-ась)")+' <a class="pointer">'+_chat_e("публикацией")+'</a> .</span><hr style="margin: 10px;">  '+_chat_e("Репостни и получи $25 на ЭПС или карту WT VISA")+"<br>"+_chat_e("Всё просто: нужно сделать репост записи, указанной ниже!")+"<br>"+_chat_e("Конкурс считается действительным, если его поддержали 100 участников!")+"<br>"+_chat_e("Победитель будет выбран случайным образом из числа репостнувших 25.04.2017")+"<br> ❗️"+_chat_e("Если конкурсы будут пользоваться популярностью, то они будут проходить на постоянной основе при поддержке партнеров!")+'<br><iframe src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2FTelegrafMoney%2Fphotos%2Fa.1327454147273051.1073741828.1318448904840242%2F1549842071700923%2F%3Ftype%3D3%26theater&width=500&show_text=true&appId=316202461909215&height=426" width="100%" style="    border: none;overflow: hidden;height: 400px;margin-top: 10px;background: #fff;" scrolling="no" frameborder="0" allowTransparency="true"></iframe>'}),localStorage.setItem("post1","see"))}else swal({title:_chat_e("Уппс..."),text:_chat_e("Попробуйте авторизоавтся повторно или перегрузить приложение."),customClass:"swal-telegraf-modal",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",showCancelButton:!0,type:"error",cancelButtonText:_chat_e("Перегрузить"),confirmButtonText:_chat_e("Выйти"),showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(e,t){var a=setTimeout(function(){t(_chat_e("Ошибка сервер недоступен."))},1e4);API("logout_this_user",{code:localStorage.getItem("installTime"),uuid:localStorage.getItem("uuid")},!0,function(t){clearTimeout(a),localStorage.clear(),e()}),setTimeout(function(){localStorage.clear(),location.reload()},4999)})},allowOutsideClick:!1}).then(function(){location.reload(),swal.closeModal()},function(){location.reload(),swal.closeModal()})},serverDisconnect:function(){console.warn("server:serverDisconnect")},openChat:function(e,t,a){Messenger.setPage("dialog"),e&&(e.last_online=moment(e.last_online_at,moment.ISO_8601).fromNow(),console.log(e),console.log(e.last_online_at),ractiveComponent.rootApp.set("open_threads",e),Messenger.threads.open=e,e.id?Messenger.chat.open(e.id,"threads_id"):Messenger.chat.open(e.webtransfer_id,"recipient_id")),t&&API("userInfo",{webtransfer_id:t},!1,function(e){e={full_name:e.user.name_first+" "+e.user.name_last,last_online_at:e.user.last_online_at,name_short:e.user.name_short,webtransfer_id:e.user.webtransfer_id,avatar_path:e.user.avatar_path},ractiveComponent.rootApp.set("open_threads",e),Messenger.threads.open=e,Messenger.chat.open(t,"recipient_id")},!0),a&&API("create_thread",{threads_id:a},!1,function(e){var t=e={avatar_path:!1|e.threads.avatar_path,count_reviews:0|e.threads.count_reviews,full_name:e.threads.full_name,group_name:e.threads.group_name,group_photo:e.threads.group_photo,group_verefy:e.threads.group_verefy,id:e.threads._id,last_message:e.threads.last_message.message,last_message_messageId:e.threads.last_message.messageId,last_message_read:e.threads.last_message.read,last_message_sender_id:e.threads.last_message.sender,last_online:"Invalid date",last_online_at:!1,my_id:MyProfile.webtransfer_id,name_short:"SL",rating:0,spam:!1,type_threads:e.threads.type,unread_count_this_thread:0,updated_at:e.threads.update_at,updated_at_text:"11:28",user_count:e.threads.user_count,users:e.threads.users,webtransfer_id:"5873d832343077901c725cf1"};t&&t.last_online_at&&(t.last_online=moment(t.last_online_at,moment.ISO_8601).fromNow(),ractiveComponent.rootApp.set("open_threads",t)),ractiveComponent.rootApp.set("open_threads",e),Messenger.threads.open=e,Messenger.chat.open(e.id,"threads_id")},!0)},push:{registrationId:null,push:null,setup:function(e){Messenger.push.push=PushNotification.init({android:{senderID:e||"290044042540"},browser:{pushServiceURL:"http://push.api.phonegap.com/v1/push"},ios:{alert:"true",badge:"true",sound:"true"},windows:{}}),Messenger.push.push.on("registration",function(e){console.log("registration event: "+e.registrationId),localStorage.getItem("registrationId")!==e.registrationId&&localStorage.setItem("registrationId",e.registrationId),Messenger.push.registrationId=e.registrationId,ractiveComponent.rootApp.set("registrationId",e.registrationId)}),Messenger.push.push.on("error",function(e){console.log("push error = "+e.message)}),Messenger.push.push.on("notification",function(e){if(0==e.additionalData.foreground&&0==e.additionalData.coldstart&&e.additionalData.key_action){var t=e.additionalData.key_action.split(":");switch(t[0]){case"chat":isNaN(+t[1])||Messenger.openChat(!1,+t[1]);break;case"thread":isNaN(+t[1])||Messenger.openChat(!1,!1,+t[1])}}console.log("notification event",arguments)})}},share:function(){var e={message:_chat_e("Скачай Telegraf.Money Messenger со встроенной бесплатной картой VISA/MC и получи бонус $50"),subject:_chat_e("Скачай Telegraf.Money Messenger со встроенной бесплатной картой VISA/MC и получи бонус $50"),url:"https://telegraf.money/?ref="+MyProfile.webtransfer_id,chooserTitle:"Invite friends to Telegraf"};window&&window.plugins&&window.plugins.socialsharing?window.plugins.socialsharing.shareWithOptions(e,function(e){},function(e){swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Ошибка"),type:"error",confirmButtonText:_chat_e("Ok"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!1,text:_chat_e("Не удалось отправить партнерскую ссылку")})}):swal.close()}};$.fn.extend({animateCss:function(e,t){$(this).addClass("animated "+e).one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass("animated "+e),t&&t()})}}),procent=.05,Messenger.on("ComponentsOnRender",function(e){console.log("ComponentsOnRender:"+e)}),window.onpopstate=function(e){location.hash.replace("#","").split("-")[0]&&""!=location.hash.replace("#","").split("-")[0]&&Messenger.setPage(location.hash.replace("#","").split("-")[0],location.hash.replace("#","").split("-")[1],!0),console.log("Messenger.setPage",location.hash.replace("#","").split("-")[0],location.hash.replace("#","").split("-")[1])};