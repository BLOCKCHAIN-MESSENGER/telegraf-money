function edit_message(){console.log("edit_message"),swal.close()}function block_user(e,t){console.log("block_user"),API("edit_threads",{threads_id:Messenger.chat.openChat,user_action:e,action:"block_user",action_data:!t},!1,function(t){t.err?noty({text:_chat_e("Ошибка блокировки пользователя"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}):noty({text:_chat_e("Заблокирован ")+"userId:"+e,type:"success",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})},!0),swal.close()}function remove_message(e){console.log("remove_message"),API("edit_threads",{threads_id:Messenger.chat.openChat,user_action:1,action:"remove_message",action_data:e},!1,function(e){if(e.error&&noty({text:_chat_e("Упс..: ")+e.error,type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),e.res)return noty({text:_chat_e("Сообщение")+" ("+e.res.message+") "+_chat_e("Удаленно!"),type:"success",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}});noty({text:_chat_e("Собщение не найденно! (Обновите чат)"),type:"info",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})},!0),swal.close()}function set_moder(e){swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Выдать права"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,text:_chat_e("Вы действительно хотите хотите назначить администратором чата:")+" ["+Messenger.chat.openChat+"]  UserID(<strong>"+e+"</strong>)",showLoaderOnConfirm:!0,preConfirm:function(){swal.close(),API("edit_threads",{threads_id:Messenger.chat.openChat,user_action:e,action:"moderator_add",action_data:!0},!1,function(t){t.err?(console.error(t),noty({text:_chat_e("Упс..."),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})):noty({text:_chat_e("Выданы права создателя чата")+" UserId:"+e,type:"success",theme:"metroui",layout:"topCenter",timeout:3e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})},!0)}})}var WtcChat=Ractive.extend({data:function(){return{messages_load:!1}},oninit:function(){console.log("Chat.oninit !"),ractiveComponent["wtc-ChatApp"].set("MyProfile",MyProfile),ractiveComponent["wtc-ChatApp"].set("messages_more",!1),Messenger.chat.callback_save(function(){ractiveComponent["wtc-ChatApp"].set("MyProfile",MyProfile),ractiveComponent["wtc-ChatApp"].set("messages",Messenger.chat.data),ractiveComponent["wtc-ChatApp"].set("threads",Messenger.chat.threads),ractiveComponent["wtc-ChatApp"].set("messages_load",!0),0!=Messenger.chat.data.length&&ractiveComponent["wtc-ChatApp"].set("messages_more","more"),$("#contentMessageScroll").nanoScroller()});var e=document.createElement("canvas").getContext("2d").createLinearGradient(0,35,0,100);e.addColorStop(.5,"rgba(255, 255, 255, 1.000)"),e.addColorStop(.5,"rgba(255, 255, 255, 1.000)")},onrender:function(){console.log("Chat.onrender !")},oncomplete:function(){console.log("Chat.oncomplete !")}});$(".arrow-st").click(function(){$(".chat-panel-bottom").toggleClass("arrows-no"),$(".arrow-st").toggleClass("arrows-position")}),$(".obms").click(function(){$(".stz").css("display","block")}),$(".avst").click(function(){$(".stz").css("display","none")}),$(document).mouseup(function(e){var t=$(".stz");0===t.has(e.target).length&&t.hide()});var timeoutUpdate_threads=setTimeout(function(){},0);Messenger.on("avatar_message_err",function(e){console.log("avatar_message_err",e),clearTimeout(timeoutUpdate_threads),Messenger.chat.data[e].sender.avatar_path=!1,timeoutUpdate_threads=setTimeout(function(){ractiveComponent["wtc-ChatApp"].set("messages",Messenger.chat.data)},100)});var event_message;Messenger.on("more_message",function(){ractiveComponent["wtc-ChatApp"].set("messages_more","load"),Messenger.chat.getHistory(function(){ractiveComponent["wtc-ChatApp"].set("messages_more","more")})}),Messenger.on("event_message",function(e){event_message=e,swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,html:'<div class="modal-chat-area"><img src="'+e.sender.avatar_path+'" class="flsg-krgs" style="cursor:pointer" onerror=""><span class="namels">'+e.sender.name_first+" "+e.sender.name_last+"<strong>ID: "+e.sender.webtransfer_id+'</strong></span><div class="close-area"></div><div class=""><div class="bg-my-chat-modal">'+e.message+'</div><div class="chat-in-check-time-area"></div></div><div class="btm-m-area"><hr><a class="chat-btn-modal ct-btn-m2 pointer" onclick="remove_message(\''+e._id+'\');return false;"> <i class="fa fa-trash-o" aria-hidden="true"></i>'+_chat_e("Удалить сообшение")+'</a><a class="chat-btn-modal ct-btn-m3 pointer" onclick="block_user('+e.sender.webtransfer_id+');return false;"> <i class="fa fa-lock" aria-hidden="true"></i>'+_chat_e("Заблокировать")+'</a><a class="chat-btn-modal ct-btn-m3 pointer" onclick="set_moder('+e.sender.webtransfer_id+');return false;"><i class="fa fa-gavel" aria-hidden="true"></i>'+_chat_e("Назначить модератором")+'</a><a class="chat-btn-modal ct-btn-m4 pointer" onclick="swal.closeModal();return false;"><i class="fa fa-times" aria-hidden="true"></i>'+_chat_e("Отмена")+"</a></div></div>",showConfirmButton:!1,showCancelButton:!1})});