function change_card(t){var e=ractiveComponent["wtc-CreditApp"].get("finance_cards");for(var r in e)if(e[r].card_id==t){var n=e[r].last_balance,o=+((n-=.005*n+.1)-n%1).toFixed(0);e[r].card_start_balanses>0&&(o-=e[r].card_start_balanses),$("#amount_credit").val(+(o-o%1).toFixed(0)),ractiveComponent["wtc-CreditApp"].set("currency",e[r].card_currency),ractiveComponent["wtc-CreditApp"].set("select_card",t);var a={GBP:"£",USD:"$",EUR:"€"};ractiveComponent["wtc-CreditApp"].set("currency_symbool",a[e[r].card_currency])}}var WtcCredit=Ractive.extend({oninit:function(){console.log("Credit.oninit !"),$(".__nano").nanoScroller();var t=!1;Messenger.finance.callback_save(function(e,r){ractiveComponent["wtc-CreditApp"].set("currency","USD"),ractiveComponent["wtc-CreditApp"].set("currency_symbool","$"),ractiveComponent["wtc-CreditApp"].set("finance_cards",e),ractiveComponent["wtc-CreditApp"].set("finance_cards_load",!0),ractiveComponent["wtc-CreditApp"].set("microinvests",r),t||(t=!0,e[0]&&change_card(e[0].card_id)),ractiveComponent["wtc-CreditApp"].set("cards",e),setTimeout(Messenger.body.credit.callback,10);var n=0,o=0;for(var a in r)r.hasOwnProperty(a)&&(n+=+r[a].summa,o+=+r[a].current_income);ractiveComponent["wtc-CreditApp"].set("microinvests_summa",n.toFixed(2)),ractiveComponent["wtc-CreditApp"].set("microinvests_current_income",o.toFixed(2)),ractiveComponent["wtc-CreditApp"].set("microinvests_total",+n+ +o.toFixed(2))}),$("input, select").styler({selectSearch:!1}),API("list_creditors",{},!1,function(t){if(t.error)return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+t.error,type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}});var e=t.data.participants.filter(function(t){return"wl"!=t.type});ractiveComponent["wtc-CreditApp"].set("list_creditors",e),$("#user_id_operator").styler().trigger("refresh")},!0),Messenger.body.credit.callback=function(){ractiveComponent["wtc-CreditApp"].set("tabPage",Messenger.body.credit.tabPage),$("#card_id_credit").styler().trigger("refresh"),$("#select_ammount").on("keydown","#amount_credit",function(t){console.log(t.keyCode),-1!==$.inArray(t.keyCode,[46,8,9,27,13,110])||/65|67|86|88/.test(t.keyCode)&&(!0===t.ctrlKey||!0===t.metaKey)||35<=t.keyCode&&40>=t.keyCode||(t.shiftKey||48>t.keyCode||57<t.keyCode)&&(96>t.keyCode||105<t.keyCode)&&t.preventDefault()})},Messenger.body.credit.callback(),setTimeout(function(){$("#user_id_operator").styler().trigger("refresh")},100)},onrender:function(){console.log("Credit.onrender !")},oncomplete:function(){console.log("Credit.oncomplete !")}});ractiveComponent["wtc-CreditApp"].on("startBorrow",function(){console.log("startBorrow"),swal({title:_chat_e("Попробуйте позже..."),type:"error",confirmButtonText:"Ok",cancelButtonText:"Отменить",showCancelButton:!1,text:_chat_e("Данная возможность находится в разработке :(")})}),ractiveComponent["wtc-CreditApp"].on("stopCredit",function(t,e){var r=[e],n=r[0].id;swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Да"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,text:_chat_e("Вы действительно хотите остановить займ")+" <strong>#"+r[0].id+"</strong> <br>"+_chat_e("суммой:")+" <strong>"+r[0].summa+" USD</strong> + "+_chat_e("прибыль:")+" <strong>"+r[0].current_income+" USD </strong><br>"+_chat_e("и вернуть средства на карту")+" <br><strong>"+r[0].card.card_name.replace("Webtransfer ","")+"</strong>",showLoaderOnConfirm:!0,preConfirm:function(){return ractiveComponent["wtc-CreditApp"].set("load_invest",!0),swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Остановка Кредита до Востребования..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("Остановка Кредита может занять несколько секунд"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),new Promise(function(t){API("stop_fast_arbitrage",{id:n},!1,function(t){ractiveComponent["wtc-CreditApp"].set("load_invest",!1),t.error||null==t.status||0==t.status?(noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка не удалось остановить займ: ")+t.error,type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close()):swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успех"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:""+_chat_e("Вам на карту:")+r[0].card.card_name.replace(/(^|\s)Webtransfer(\s|$)/g,"")+" "+_chat_e("отправленно")+" <strong>"+(+r[0].summa+ +r[0].current_income)+" USD</strong>"}),Messenger.finance.update()},!0)})}})}),ractiveComponent["wtc-CreditApp"].on("startLoans",function(){var t=ractiveComponent["wtc-CreditApp"].get("finance_cards");for(var e in t)if(t[e].card_id==$("#card_id_credit").val()){t[e].last_balance;if(console.log(t[e].card_currency),isNaN(+$("#amount_credit").val()))return noty({text:_chat_e("Некорректно указана сумма  займа:")+": "+$("#amount_credit").val(),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),!1;if(+$("#amount_credit").val()<1)return noty({text:_chat_e("Сумма не может быть меньше")+" <strong>1 "+t[e].card_currency+"</strong>",type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),!1;if(""==$("#user_id_operator").val()||!$("#user_id_operator").val())return noty({text:_chat_e("Вы не выбрали оператора КВД ставки"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),!1;swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Выдать займ"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,text:_chat_e("Вы действительно хотите выдать займ суммой:")+" <strong>"+ +$("#amount_credit").val()+" "+t[e].card_currency+"</strong> "+_chat_e("с карты")+" <strong>"+t[e].card_name.replace(/(^|\s)Webtransfer(\s|$)/g,"")+"</strong>",showLoaderOnConfirm:!0,preConfirm:function(){return swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Запуск Кредита до Востребования..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("может занять несколько секунд"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),ractiveComponent["wtc-CreditApp"].set("load_invest",!0),new Promise(function(r){API("start_fast_arbitrage",{credit_user_id:$("#user_id_operator").val(),card_id:$("#card_id_credit").val(),summ:$("#amount_credit").val()},!1,function(r){if(ractiveComponent["wtc-CreditApp"].set("load_invest",!1),r.error){var n=_chat_e(r.error);"_ERR_String"==n&&(n=r.error),noty({text:_chat_e("Ошибка: ")+n,type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close()}else swal({title:_chat_e("Успешно"),type:"success",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Ok"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!1,text:_chat_e("Вы успешно запустили кредит суммой")+": <strong>"+ +$("#amount_credit").val()+" "+t[e].card_currency+"</strong>"});Messenger.finance.update()},!0)})}})}}),ractiveComponent["wtc-CreditApp"].on("openCredit",function(t,e){$("body .credit-wrapper .credit-main-area .toggle .body-"+e).toggle("")});