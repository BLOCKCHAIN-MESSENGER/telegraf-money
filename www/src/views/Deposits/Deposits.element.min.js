function get_deposit_debit(t){ractiveComponent["wtc-DepositsApp"].set("depositsList."+t,!1),ractiveComponent["wtc-DepositsApp"].set("depositsList_loader",!1),API("get_deposit_debit",{payment_system:t},!1,function(e){for(var o in e.data)"BTX"!==e.data[o].payment_system&&"ETX"!==e.data[o].payment_system||(e.data[o].sum=(e.data[o].sum/1e8).toFixed(6),e.data[o].fund.sum=(e.data[o].fund.sum/1e8).toFixed(6));ractiveComponent["wtc-DepositsApp"].set("depositsList."+t,e.data),ractiveComponent["wtc-DepositsApp"].set("depositsList_loader",!0)},!0)}function change_input_deposit(){var t=["3","7","14","21","30","90","180","365"],e={amount:$("#amount_deposits").val(),duration:t[$("#ex21").val()-1],percent:$("#input_deposits_prc").val()};hi_graf(),ractiveComponent["wtc-DepositsApp"].set("deposit_amount",+(+e.amount).toFixed(2)),ractiveComponent["wtc-DepositsApp"].set("deposit_total",+(+e.amount+e.amount/100*e.percent*e.duration).toFixed(2)),ractiveComponent["wtc-DepositsApp"].set("deposit_profit",+(+e.amount/100*e.percent*e.duration).toFixed(2))}function hi_graf(t,e){if(e&&(render=e),console.log(e,render),1==render){$("#b8").css("display","block");var o=["3","7","14","21","30","90","180","365"],n=$("#payment_system").val(),s=o[$("#ex21").val()-1],a=$("#prc_type").val(),r="";r=categories&&categories[n]&&categories[n][a]&&categories[n][a][s]&&categories[n][a][s].name?categories[n][a][s].name:"";var i="";i=series&&series[n]&&series[n][a]&&series[n][a][s]?function(t,e){if(!e||!t)return!1;var o=e.slice(0);o.sort(function(t,e){return t-e}),console.error("start sorting"),console.log("--101",e),console.log("--201",o),console.log("--301",t);var n=t;return $.each(n,function(t,o){var s=o.data;n[t].data=[],$.each(s,function(o,s){var a=e[o];n[t].data[a]=s,console.log("--002",t+" : "+a+" = "+s)})}),$.each(n,function(t,e){var o=e.data;n[t].data=[],console.log("--005",o);var s,a,r,i=[];for(a in o)o.hasOwnProperty(a)&&i.push(a);for(i.sort(function(t,e){return t-e}),s=i.length,r=0;r<s;r++)a=i[r],console.log("--001",a+":"+o[a]),o[a]>=1e3&&n[t].data.push(o[a])}),n}(i=series[n][a][s],r):"",r&&r.sort(function(t,e){return t-e});var c=[];$.each(r,function(t,e){c[t]=Number(e).toFixed(2)+"%"});Highcharts.chart("b8",{chart:{type:"column"},title:{text:"Deposit offer statistics"},yAxis:{min:0,title:{text:"Total in currency"}},xAxis:{categories:c},credits:{enabled:!1},series:i})}}var series,categories,render=0;ractiveComponent["wtc-DepositsApp"].set("tab","create");var WtcDeposits=Ractive.extend({oninit:function(){console.log("Debitcoin.oninit !"),$(".__nano").nanoScroller(),$("input, select").styler({selectSearch:!1}),$("#ex21").bootstrapSlider(),Messenger.crypto.update(),ractiveComponent["wtc-DepositsApp"].set("crypto_wallets",Messenger.crypto.wallets),ractiveComponent["wtc-DepositsApp"].set("MyProfile",MyProfile),ractiveComponent["wtc-DepositsApp"].set("device_platform",paramSocket.device_platform_type),ractiveComponent["wtc-DepositsApp"].set("payment_system_deposits","WDG"),"active"===ractiveComponent["wtc-DepositsApp"].get("tab")&&get_deposit_debit(ractiveComponent["wtc-DepositsApp"].get("payment_system_deposits")),"create"===ractiveComponent["wtc-DepositsApp"].get("tab")&&($("#wallets_deposit")&&$("#wallets_deposit").styler().trigger("refresh"),$("#payment_system")&&$("#payment_system").styler().trigger("refresh"),change_input_deposit())},onrender:function(){console.log("Debitcoin.onrender !")},oncomplete:function(){console.log("Debitcoin.oncomplete !")}});ractiveComponent["wtc-DepositsApp"].on("stopProfit",function(t,e){console.log(t,e);var o=e.profit.sum;e.fund.sum<o&&(o=e.fund.sum),o=Math.ceil(1e4*o)/1e4,swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Да"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,html:_chat_e("Вы действительно хотите вывести прибыль депозита.")+"<br>ID: #"+e.id+"<br>"+_chat_e("Сумма вывода:")+" "+o+" DBC",showLoaderOnConfirm:!0,preConfirm:function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Вывод депозита на кошелек DEBIT Coin..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:"",preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),API("stop_profit_deposit_debit",{amount:o,deposit_id:e.id},!1,function(t){if(t.error)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Error:"+t.error});if(t.result&&t.result.error)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Error:"+t.result.error});return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успешно"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:_chat_e("Перевод отправлен в обработку txHash:")+' <a href="https://etherscan.io/tx/'+t.result.data.blockchainTnxId+'" target="_blank">'+t.result.data.blockchainTnxId+"</a>"})},!0)}})}),ractiveComponent["wtc-DepositsApp"].on("get_deposits",function(t,e){ractiveComponent["wtc-DepositsApp"].set("payment_system_deposits",e),get_deposit_debit(e)}),ractiveComponent["wtc-DepositsApp"].on("stopDeposit",function(t,e){console.log(t,e);var o=e.sum;e.fund.sum<o&&(o=e.fund.sum),swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Да"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,html:_chat_e("Вы действительно хотите остановить депозит.")+"<br>ID: #"+e.id+"<br>"+_chat_e("Сумма вывода:")+" "+o+" DBC",showLoaderOnConfirm:!0,preConfirm:function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Вывод депозита на кошелек DEBIT Coin..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:"",preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),API("stop_deposit_debit",{amount:o,deposit_id:e.id},!1,function(t){if(t.error)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Error:"+t.error});if(t.result.error)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Error:"+t.error});return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успешно"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:_chat_e("Перевод отправлен в обработку txHash:")+' <a href="https://etherscan.io/tx/'+t.result.data.blockchainTnxId+'" target="_blank">'+t.result.data.blockchainTnxId+"</a>"})},!0)}})}),ractiveComponent["wtc-DepositsApp"].on("start",function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Запуск депозита..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("Запуск депозита может занять несколько секунд"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},1e4)})}}),swal.showLoading();var t=["3","7","14","21","30","90","180","365"];if(!t[$("#ex21").val()-1])return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка срока депозита"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if(isNaN(+$("#amount_deposits").val()))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка суммы депозита"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if(isNaN(+$("#input_deposits_prc").val()))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка Процента депозита"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;var e=$("#payment_system");if("DBC"===e.find(":selected").data("type")){if(+$("#amount_deposits").val()>+e.find(":selected").data("balance"))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("У вас недостаточно средств")+" DBC",type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if(Crypto.getBalance(e.val(),"ETH")<.001)return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("У вас недостаточно средств")+" min:0.001 ETH "+_chat_e("Для оплаты комиссии за транзакцию."),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1}var o="https://etherscan.io/tx/";"BTX"===e.find(":selected").data("type")&&(o="https://blockchain.info/tx/"),swal.showLoading(),API("startBlockchainDepositDebitCoin",{payment_system:e.find(":selected").data("type"),from_address:e.val(),amount:1*$("#amount_deposits").val(),duration:t[$("#ex21").val()-1],percent:$("#input_deposits_prc").val(),percent_type:$("#prc_type").val()},!1,function(t){if(t.error)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Try later ("+t.error+")"});swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Да"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,text:_chat_e("Вы действительно хотите перевести:")+" <strong>"+1*$("#amount_deposits").val()+" "+e.find(":selected").data("type")+"</strong><br>"+_chat_e("На адрес:")+" Deposit fund <strong>"+t.address_fund+"</strong> GasPrice: <strong>15 Gwei</strong>",showLoaderOnConfirm:!0,preConfirm:function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Создание перевода..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:"",preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),Crypto.transferDBC({from:e.val(),gasPrice:15,to:t.address_fund,amount:+t.deposit.sum},function(t){swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успех"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:'TX: <a href="'+o+t+'" target="_blank">'+t+"</a>"})})}})},!0)}),$("#select_deposits_amount").on("keydown","#amount_deposits",function(t){190!=t.keyCode&&188!=t.keyCode||-1!=t.target.value.indexOf(".")&&t.preventDefault(),-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,188,190])||/65|67|86|88/.test(t.keyCode)&&(!0===t.ctrlKey||!0===t.metaKey)||35<=t.keyCode&&40>=t.keyCode||(t.shiftKey||48>t.keyCode||57<t.keyCode)&&(96>t.keyCode||105<t.keyCode)&&t.preventDefault()}),$("#select_deposits_prc").on("keydown","#input_deposits_prc",function(t){190!=t.keyCode&&188!=t.keyCode||-1!=t.target.value.indexOf(".")&&t.preventDefault(),-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,188,190])||/65|67|86|88/.test(t.keyCode)&&(!0===t.ctrlKey||!0===t.metaKey)||35<=t.keyCode&&40>=t.keyCode||(t.shiftKey||48>t.keyCode||57<t.keyCode)&&(96>t.keyCode||105<t.keyCode)&&t.preventDefault()}),$("#select_deposits_prc").on("keyup","#input_deposits_prc",function(t){190!=t.keyCode&&188!=t.keyCode||(t.target.value.indexOf("."),$("#input_deposits_prc").val(t.target.value.replace(t.key,".")))}),$("#select_deposits_amount").on("keyup","#amount_deposits",function(t){190!=t.keyCode&&188!=t.keyCode||(t.target.value.indexOf("."),$("#amount_deposits").val(t.target.value.replace(t.key,".")))}),change_input_deposit(),ractiveComponent["wtc-DepositsApp"].on("openToggle",function(t,e){$("body .deposits-wrapper .credit-main-area .toggle .body-"+e).toggle("")});