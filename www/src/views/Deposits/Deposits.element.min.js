function get_deposit_debit(t){ractiveComponent["wtc-DepositsApp"].set("depositsList."+t,!1),API("get_deposit_debit",{payment_system:t},!1,function(e){for(var o in e.data)"BTX"!==e.data[o].payment_system&&"ETX"!==e.data[o].payment_system||(e.data[o].sum=(e.data[o].sum/1e8).toFixed(6),e.data[o].fund.sum=(e.data[o].fund.sum/1e8).toFixed(6));ractiveComponent["wtc-DepositsApp"].set("depositsList."+t,e.data)},!0)}function change_input_deposit(){var t=["3","7","14","21","30","90","180","365"],e={amount:$("#amount_deposits").val(),duration:t[$("#ex21").val()-1],percent:$("#input_deposits_prc").val()};hi_graf(),ractiveComponent["wtc-DepositsApp"].set("deposit_amount",+(+e.amount).toFixed(2)),ractiveComponent["wtc-DepositsApp"].set("deposit_total",+(+e.amount+e.amount/100*e.percent*e.duration).toFixed(2)),ractiveComponent["wtc-DepositsApp"].set("deposit_profit",+(+e.amount/100*e.percent*e.duration).toFixed(2))}function hi_graf(t,e){if(e&&(render=e),console.log(e,render),1==render){$("#b8").css("display","block");var o=["3","7","14","21","30","90","180","365"],n=$("#payment_system").val(),s=o[$("#ex21").val()-1],a=$("#prc_type").val(),i="";i=categories&&categories[n]&&categories[n][a]&&categories[n][a][s]&&categories[n][a][s].name?categories[n][a][s].name:"";var r="";r=series&&series[n]&&series[n][a]&&series[n][a][s]?function(t,e){if(!e||!t)return!1;e.slice(0).sort(function(t,e){return t-e}),console.error("start sorting");var o=t;return $.each(o,function(t,n){var s=n.data;o[t].data=[],$.each(s,function(n,s){var a=e[n];o[t].data[a]=s})}),$.each(o,function(t,e){var n=e.data;o[t].data=[],console.log(n);var s,a,i,r=[];for(a in n)n.hasOwnProperty(a)&&r.push(a);for(r.sort(function(t,e){return t-e}),s=r.length,i=0;i<s;i++)a=r[i],console.log(a+":"+n[a]),o[t].data.push(n[a])}),o}(r=series[n][a][s],i):"",i&&i.sort(function(t,e){return t-e});var c=[];$.each(i,function(t,e){c[t]=Number(e).toFixed(2)+"%"});Highcharts.chart("b8",{chart:{type:"column"},title:{text:"Deposit offer statistics"},yAxis:{min:0,title:{text:"Total in currency"}},xAxis:{categories:c},credits:{enabled:!1},series:r})}else $("#b8").css("display","none")}var series,categories,render=0;ractiveComponent["wtc-DepositsApp"].set("tab","create");var WtcDeposits=Ractive.extend({oninit:function(){console.log("Debitcoin.oninit !"),$(".__nano").nanoScroller(),$("input, select").styler({selectSearch:!1}),$("#ex21").bootstrapSlider(),ractiveComponent["wtc-DepositsApp"].set("MyProfile",MyProfile),ractiveComponent["wtc-DepositsApp"].set("device_platform",paramSocket.device_platform_type),ractiveComponent["wtc-DepositsApp"].set("finance_debit_coin_gold","..."),ractiveComponent["wtc-DepositsApp"].set("btc_finance_btc","..."),ractiveComponent["wtc-DepositsApp"].set("eth_finance_eth","..."),ractiveComponent["wtc-DepositsApp"].set("payment_system_deposits","WDG"),"active"===ractiveComponent["wtc-DepositsApp"].get("tab")&&get_deposit_debit(ractiveComponent["wtc-DepositsApp"].get("payment_system_deposits")),"create"===ractiveComponent["wtc-DepositsApp"].get("tab")&&(Messenger.finance.callback_save(function(t,e,o,n){t&&0!=t.length||(t=!1),ractiveComponent["wtc-DepositsApp"].set("finance_cards",t),n&&(n.wallet&&ractiveComponent["wtc-DepositsApp"].set("wallets",n.wallet),$("#wallets_deposit")&&$("#wallets_deposit").styler().trigger("refresh"),ractiveComponent["wtc-DepositsApp"].set("finance_cards_load",!0))}),API("wallet_coin",{type:"DBC"},!1,function(t){ractiveComponent["wtc-DepositsApp"].set("debit_token",t),ractiveComponent["wtc-DepositsApp"].set("finance_debit_coin_gold",t.wallet.balance.dbc),ractiveComponent["wtc-DepositsApp"].set("finance_eth",t.wallet.balance.eth),ractiveComponent["wtc-DepositsApp"].set("eth_finance_eth",t.wallet.balance.eth.toFixed(4)),ractiveComponent["wtc-DepositsApp"].set("finance_ethusd",t.wallet.balance.ethusd),$("#wallets_deposit")&&$("#wallets_deposit").styler().trigger("refresh"),$("#payment_system")&&$("#payment_system").styler().trigger("refresh"),API("wallet_coin",{type:"BTC"},!1,function(t){ractiveComponent["wtc-DepositsApp"].set("btc_wallet",t),ractiveComponent["wtc-DepositsApp"].set("btc_finance_btc",t.wallet.balance.btc.toFixed(4)),$("#wallets_deposit")&&$("#wallets_deposit").styler().trigger("refresh"),$("#payment_system")&&$("#payment_system").styler().trigger("refresh")},!0)},!0),API("deposits_info",{},!1,function(t){series=t.series,categories=t.categories,hi_graf(),ractiveComponent["wtc-DepositsApp"].set("loaddepositsList",!0)},!0),$("#select_deposits_amount").on("keydown","#amount_deposits",function(t){190!=t.keyCode&&188!=t.keyCode||-1!=t.target.value.indexOf(".")&&t.preventDefault(),-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,188,190])||/65|67|86|88/.test(t.keyCode)&&(!0===t.ctrlKey||!0===t.metaKey)||35<=t.keyCode&&40>=t.keyCode||(t.shiftKey||48>t.keyCode||57<t.keyCode)&&(96>t.keyCode||105<t.keyCode)&&t.preventDefault()}),$("#select_deposits_prc").on("keydown","#input_deposits_prc",function(t){190!=t.keyCode&&188!=t.keyCode||-1!=t.target.value.indexOf(".")&&t.preventDefault(),-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,188,190])||/65|67|86|88/.test(t.keyCode)&&(!0===t.ctrlKey||!0===t.metaKey)||35<=t.keyCode&&40>=t.keyCode||(t.shiftKey||48>t.keyCode||57<t.keyCode)&&(96>t.keyCode||105<t.keyCode)&&t.preventDefault()}),$("#select_deposits_prc").on("keyup","#input_deposits_prc",function(t){190!=t.keyCode&&188!=t.keyCode||(t.target.value.indexOf("."),$("#input_deposits_prc").val(t.target.value.replace(t.key,".")))}),$("#select_deposits_amount").on("keyup","#amount_deposits",function(t){190!=t.keyCode&&188!=t.keyCode||(t.target.value.indexOf("."),$("#amount_deposits").val(t.target.value.replace(t.key,".")))}),change_input_deposit())},onrender:function(){console.log("Debitcoin.onrender !")},oncomplete:function(){console.log("Debitcoin.oncomplete !")}});ractiveComponent["wtc-DepositsApp"].on("stopProfit",function(t,e){console.log(t,e);var o=e.profit.sum;e.fund.sum<o&&(o=e.fund.sum),swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Да"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,html:_chat_e("Вы действительно хотите вывести прибыль депозита.")+"<br>ID: #"+e.id+"<br>"+_chat_e("Сумма вывода:")+" "+o+" DBC",showLoaderOnConfirm:!0,preConfirm:function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Вывод депозита на кошелек DEBIT Coin..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:"",preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),API("stop_profit_deposit_debit",{amount:o,deposit_id:e.id},!1,function(t){return t.error?swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Error:"+t.error}):swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успешно"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:_chat_e("Перевод отправлен в обработку txHash:")+" "+t.txHash})},!0)}})}),ractiveComponent["wtc-DepositsApp"].on("get_deposits",function(t,e){ractiveComponent["wtc-DepositsApp"].set("payment_system_deposits",e),get_deposit_debit(e)}),ractiveComponent["wtc-DepositsApp"].on("stopDeposit",function(t,e){console.log(t,e);var o=e.sum;e.fund.sum<o&&(o=e.fund.sum),swal({title:_chat_e("Подтверждение"),type:"question",customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",confirmButtonText:_chat_e("Да"),cancelButtonText:_chat_e("Отменить"),showCancelButton:!0,html:_chat_e("Вы действительно хотите остановить депозит.")+"<br>ID: #"+e.id+"<br>"+_chat_e("Сумма вывода:")+" "+o+" DBC",showLoaderOnConfirm:!0,preConfirm:function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Вывод депозита на кошелек DEBIT Coin..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:"",preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),API("stop_deposit_debit",{amount:o,deposit_id:e.id},!1,function(t){return t.error?swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Error:"+t.error}):swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успешно"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:_chat_e("Перевод отправлен в обработку txHash:")+" "+t.txHash})},!0)}})}),ractiveComponent["wtc-DepositsApp"].on("start",function(){swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Запуск депозита..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("Запуск депозита может занять несколько секунд"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},1e4)})}}),swal.showLoading();var t=["3","7","14","21","30","90","180","365"];if(!t[$("#ex21").val()-1])return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка срока депозита"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if(isNaN(+$("#amount_deposits").val()))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка суммы депозита"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if(isNaN(+$("#input_deposits_prc").val()))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("Ошибка Процента депозита"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if("WDG"===$("#payment_system").val()&&+$("#amount_deposits").val()>+ractiveComponent["wtc-DepositsApp"].get("finance_debit_coin_gold"))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("У вас недостаточно средств")+" DBC",type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;var e=1;if("BTX"!==$("#payment_system").val()&&"ETX"!==$("#payment_system").val()||(e=1e8),"BTX"===$("#payment_system").val()&&+$("#amount_deposits").val()>+ractiveComponent["wtc-DepositsApp"].get("btc_finance_btc"))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("У вас недостаточно средств")+" BTC",type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;if("ETX"===$("#payment_system").val()&&+$("#amount_deposits").val()>+ractiveComponent["wtc-DepositsApp"].get("eth_finance_eth"))return noty({text:"<strong>"+_chat_e("Ошибка!")+"</strong><br>"+_chat_e("У вас недостаточно средств")+" ETH",type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),swal.close(),!1;swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Запуск депозита..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("Запуск депозита может занять несколько секунд"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},1e4)})}});var o="https://etherscan.io/tx/";"BTX"===$("#payment_system").val()&&(o="https://blockchain.info/tx/"),swal.showLoading(),API("start_deposit_debit",{payment_system:$("#payment_system").val(),amount:$("#amount_deposits").val()*e,duration:t[$("#ex21").val()-1],percent:$("#input_deposits_prc").val(),percent_type:$("#prc_type").val()},!1,function(t){if("success"!=t.status)return swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Уппс..."),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:"Try later ("+t.message+"/"+t.error+")"});swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успех"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:'TX: <a href="'+o+t.data.blockchainTnxId+'" target="_blank">'+t.data.blockchainTnxId+"</a>"}),API("get_deposit_debit",{},!1,function(t){ractiveComponent["wtc-DepositsApp"].set("depositsList",t.data)},!0),setTimeout(function(){API("wallet_coin",{type:"DBC"},!1,function(t){ractiveComponent["wtc-DepositsApp"].set("debit_token",t),ractiveComponent["wtc-DepositsApp"].set("finance_debit_coin_gold",t.wallet.balance.dbc),ractiveComponent["wtc-DepositsApp"].set("finance_eth",t.wallet.balance.eth),ractiveComponent["wtc-DepositsApp"].set("finance_ethusd",t.wallet.balance.ethusd),$("#wallets_deposit")&&$("#wallets_deposit").styler().trigger("refresh"),$("#payment_system")&&$("#payment_system").styler().trigger("refresh")},!0)},2e4)},!0)}),ractiveComponent["wtc-DepositsApp"].on("popularebtn",hi_graf),ractiveComponent["wtc-DepositsApp"].on("openToggle",function(t,e){$("body .deposits-wrapper .credit-main-area .toggle .body-"+e).toggle("")});