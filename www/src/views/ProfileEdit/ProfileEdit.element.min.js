var WtcProfileEdit=Ractive.extend({oninit:function(){console.log("ProfileEdit .oninit !"),ractiveComponent["wtc-ProfileEditApp"].set("MyProfile",MyProfile),ractiveComponent["wtc-ProfileEditApp"].set("dd",["01","02","03","04","05","06","07","08","09",10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]),ractiveComponent["wtc-ProfileEditApp"].set("mm",["01","02","03","04","05","06","07","08","09",10,11,12]),ractiveComponent["wtc-ProfileEditApp"].set("yyyy",[1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1954,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1976,1977,1978,1979,1980,1981,1982,1983,1984,1985,1986,1987,1988,1989,1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2e3,2001]),Messenger.auth_action.call_wait_auth(function(){Messenger.threads.callback_save("ProfileEditApp",function(t){ractiveComponent["wtc-ProfileEditApp"].set("threads",t),ractiveComponent["wtc-ProfileEditApp"].set("threads_finish",Messenger.threads.finish),$(".__nano").nanoScroller()})}),$(".__nano").nanoScroller(),$(".phone-inp").val(MyProfile.phone),$("#sex_filed").val(MyProfile.sex),$("#place_filed").val(MyProfile.place);var t=MyProfile.born.split("-");$("#born0").val(t[0]),$("#born1").val(t[1]),$("#born2").val(t[2]),this.on("errorAvatarMy",function(t,e,o,n){window.Messenger&&Messenger.event.errorAvatarMy&&Messenger.event.errorAvatarMy()}),$('input, select[data-styler!="off"]').styler({}),$(".acc-nts").on("change","input:file",function(t){console.log("change1");var e=this;if(e.files&&e.files[0])for(var o=0;o<e.files.length;o++)!function(t){var e={maxWidth:70};loadImage.parseMetaData(t,function(o){o.exif&&(e.orientation=o.exif.get("Orientation")),displayThumbnail(t,e)})}(e.files[o])}),$("form.ava-form").on("submit",function(t){t.preventDefault();var e=$("form.ava-form").find("input[type=file]")[0].files[0],o=new FileReader;o.addEventListener("load",function(){API("profileAvatarEdit",{base64:o.result},!1,function(t){console.warn(t),t.error?"type"==t.code?swal({title:_chat_e("Ошибка формата файла"),type:"error",customClass:"swal-telegraf-modal",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",showCancelButton:!1,html:_chat_e("Вы пытаетесь загрузить изображение с неподерживаем типом .Загрузите фото формата png,jpg,jpeg")}):"resize"==t.code?swal({title:_chat_e("Ошибка разрешения"),type:"error",customClass:"swal-telegraf-modal",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",showCancelButton:!1,html:_chat_e("Невозможно обработать изображение. Загрузите другой файл.")}):"errupload"==t.code?swal({title:_chat_e("Ошибка слишком большой файл."),type:"error",customClass:"swal-telegraf-modal",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",showCancelButton:!1,html:_chat_e("Вы пытаетесь загрузить слишком большой файл. Загрузите файл меньще 2 Мб.")}):swal({title:_chat_e("Ошибка сервера ::")+t.code,type:"error",customClass:"swal-telegraf-modal",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",showCancelButton:!1,html:_chat_e("Ответ сервера:")+t.error}):(MyProfile.avatar_path=t.url+"?versionUpdate="+Math.random(),Messenger.MyProfileUpdate(),swal({title:_chat_e("Успешно"),type:"success",customClass:"swal-telegraf-modal",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",showCancelButton:!1,html:_chat_e("Ваше изображение загружено.")}))})},!1),e&&o.readAsDataURL(e)})},onrender:function(){console.log("ProfileEdit .onrender !")},oncomplete:function(){console.log("ProfileEdit .oncomplete !")}});!function(t,e,o){var n=t.querySelectorAll(".inputfile");Array.prototype.forEach.call(n,function(t){var e=t.nextElementSibling,o=e.innerHTML;t.addEventListener("change",function(t){(this.files&&this.files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):t.target.value.split("\\").pop())||(e.innerHTML=o)}),t.addEventListener("focus",function(){t.classList.add("has-focus")}),t.addEventListener("blur",function(){t.classList.remove("has-focus")})})}(document,window);var displayThumbnail=function(t,e){console.log("displayThumbnail"),loadImage(t,function(t){var e=$('<div class="acc-nts" style="height: 70px"> <div class="account-img-area mCS_img_loaded test-ava" style="position: absolute" ></div> <div style="top: 3px;left: 102px;position: absolute"><div class="stars-area" title="Количество отзывов: '+MyProfile.count_reviews+'"><span class="p-title">'+MyProfile.first_name+" "+MyProfile.last_name+'</span> <div class="no-star"></div> <div class="no-star"></div> <div class="no-star"></div> <div class="no-star"></div> <div class="no-star"></div> </div></div></div>');"error"!==t.type&&e.find(".account-img-area ").html(t),swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",cancelButtonText:_chat_e("Оставить старую"),title:_chat_e("Обновить фотографию?"),html:e,confirmButtonColor:"#3085d6",showCancelButton:!0,confirmButtonText:_chat_e("Обновить")}).then(function(){$("form.ava-form").submit()})},e)};ractiveComponent["wtc-ProfileEditApp"].on("set_phone",function(){var t=$(".phone-inp").val();if(!t||""==t||isNaN(+t.replace("+","")))return swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",type:"error",title:_chat_e("Ошибка"),html:_chat_e("Не верный формат заполнения номера телефона"),confirmButtonColor:"#3085d6",showCancelButton:!1,confirmButtonText:_chat_e("Ок")}),!1;swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Верификация..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("Загрузка страницы верификации номера телефона"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),swal.showLoading(),API("edit_phone",{phone:t},function(t){if(!t||"success"!=t.status||t.error)return swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",type:"error",title:_chat_e("Ошибка"),html:_chat_e("Вы данный  номер не возможно верефецировать"),confirmButtonColor:"#3085d6",showCancelButton:!1,confirmButtonText:_chat_e("Ок")}),!1;__link(t.link,function(){swal.close()}),setTimeout(swal.close,1e4)},!0)}),ractiveComponent["wtc-ProfileEditApp"].on("save",function(){var t=$("#profile_edit").serializeObject();t.born=t.born_2+"-"+t.born_1+"-"+t.born_0;for(var e in t)""==t[e]&&delete t[e];API("profileEdit",t,!1,function(t){API("userInfo_auth",{},function(t){MyProfile=t,setTimeout(function(){Messenger.MyProfileUpdate()},100),"orderCard"==ractiveComponent["wtc-ProfileEditApp"].get("tab")&&(MyProfile&&MyProfile.first_name&&MyProfile.name_short&&MyProfile.phone&&MyProfile.place&&MyProfile.adr_index&&MyProfile.first_name&&MyProfile.adr_town&&MyProfile.adr_street&&MyProfile.born&&""!=MyProfile.first_name&&""!=MyProfile.name_short&&""!=MyProfile.phone&&""!=MyProfile.place&&""!=MyProfile.adr_index&&""!=MyProfile.first_name&&""!=MyProfile.adr_town&&""!=MyProfile.adr_street&&""!=MyProfile.born_1&&""!=MyProfile.born_0&&""!=MyProfile.born_2&&MyProfile.born_1&&MyProfile.born_0&&MyProfile.born_2&&""!=MyProfile.born?(swal({customClass:"swal-telegraf-modal select-form text-center",title:_chat_e("Активация карты..."),closeOnConfirm:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!0,showCancelButton:!1,showLoaderOnConfirm:!0,text:_chat_e("Активация карты может занять несколько минут"),preConfirm:function(){return new Promise(function(t,e){setTimeout(function(){t()},3e4)})}}),Messenger.setPage("cards"),swal.showLoading(),API("orderCard",{currency:"usd",card_type:"virtual",agree:!0},function(t){t.error?swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Ошибка активации карты"),type:"error",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:t.error}):(Messenger.finance.update(),swal({customClass:"swal-telegraf-modal select-form text-center",buttonsStyling:!1,confirmButtonClass:"button-n",cancelButtonClass:"cansel-btns",title:_chat_e("Успех"),type:"success",confirmButtonText:_chat_e("Ок"),showCancelButton:!1,text:_chat_e("Вы успешно активировали карту!")}))},!0)):swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",type:"error",title:_chat_e("Ошибка"),html:_chat_e("Вы заполнили не все поля"),confirmButtonColor:"#3085d6",showCancelButton:!1,confirmButtonText:_chat_e("Ок")}))},!0),"success"==t.status?"orderCard"!=ractiveComponent["wtc-ProfileEditApp"].get("tab")&&swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",type:"success",title:_chat_e("Успех"),html:_chat_e("Ваш профиль был обновлён"),confirmButtonColor:"#3085d6",showCancelButton:!1,confirmButtonText:_chat_e("Ок")}):swal({customClass:"swal-telegraf-modal select-form",buttonsStyling:!1,confirmButtonClass:"button-n",type:"error",title:_chat_e("Упс..."),html:_chat_e("Вы допустили ошибки при заполнении профиля"),confirmButtonColor:"#3085d6",showCancelButton:!1,confirmButtonText:_chat_e("Ок")})},!0)});