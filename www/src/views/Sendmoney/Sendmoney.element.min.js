function select_user_send_money(e){"id"==e?(ractiveComponent["wtc-SendmoneyApp"].get("scanUserByID")&&ractiveComponent["wtc-SendmoneyApp"].get("scanUserByID").user&&select_user_send_money(ractiveComponent["wtc-SendmoneyApp"].get("scanUserByID").user.webtransfer_id),ractiveComponent["wtc-SendmoneyApp"].set("byUserId",!0),ractiveComponent["wtc-SendmoneyApp"].set("scanUserByID_status_list","err")):(ractiveComponent["wtc-SendmoneyApp"].set("byUserId",!1),ractiveComponent["wtc-SendmoneyApp"].set("scanUserByID_status_list","ok"),$("#recipent-card-sendmoney")[0].innerHTML='<option class="" disabled selected>'+_chat_e("Загрузка...")+"</option>",$("#recipent-card-sendmoney").styler()&&$("#recipent-card-sendmoney").styler().trigger&&$("#recipent-card-sendmoney").styler().trigger("refresh")),API("get_finance_data_by_user",{webtransfer_id:e},!1,function(e){var t="";e.cards.forEach(function(e){t='<option class="lts" value="'+e.card_id+'">'+e.card_name.replace(/(^|\s)Webtransfer(\s|$)/g,"")+"</option>"+t}),""==t&&(t='<option class="" disabled selected>'+_chat_e("Нет активных карт")+"</option>"),$("#recipent-card-sendmoney")[0].innerHTML=t,setTimeout(function(){$("#recipent-card-sendmoney").styler().trigger("refresh"),ractiveComponent["wtc-SendmoneyApp"].set("recipent",e.user)},10)},!0)}function change_cardSendmoneyApp(e){console.log("change",e);var t=ractiveComponent["wtc-SendmoneyApp"].get("finance_cards");for(var n in t)if(t[n].card_id==e){var o=t[n].last_balance,r=+((o-=.005*o+.1)-o%1).toFixed(0);t[n].card_start_balanses>0&&(r-=t[n].card_start_balanses);var a=+(r-r%1).toFixed(0);a<=0&&(a=0),ractiveComponent["wtc-SendmoneyApp"].set("max_ammount",a),ractiveComponent["wtc-SendmoneyApp"].set("currency",t[n].card_currency),ractiveComponent["wtc-SendmoneyApp"].set("select_card",e);var c={GBP:"£",USD:"$",EUR:"€"};ractiveComponent["wtc-SendmoneyApp"].set("currency_symbool",c[t[n].card_currency])}}var WtcSendmoney=Ractive.extend({data:function(){return{form:{user_id:""}}},oninit:function(){console.log("sendmoney.oninit !"),ractiveComponent["wtc-SendmoneyApp"].set("byUserId",!0),ractiveComponent["wtc-SendmoneyApp"].set("MyProfile",MyProfile),Messenger.finance.callback_save(function(e){e&&0!=e.length||(e=!1),ractiveComponent["wtc-SendmoneyApp"].set("finance_cards",e),ractiveComponent["wtc-SendmoneyApp"].set("finance_cards_load",!0),setTimeout(function(){$("#mycard-sendmoney").styler().trigger("refresh"),change_cardSendmoneyApp($("#mycard-sendmoney").val())},10)}),$("input, select").styler({selectSearch:!1});Messenger.friends.callback_save(function(e){ractiveComponent["wtc-SendmoneyApp"].set("recipents_contacts",e),$("#recipents_variant-sendmoney").styler().trigger("refresh")}),$(".__nano").nanoScroller()},onrender:function(){console.log("sendmoney.onrender !")},oncomplete:function(){console.log("sendmoney.oncomplete !")}});ractiveComponent["wtc-SendmoneyApp"].on("send_money_step_1",function(){ractiveComponent["wtc-SendmoneyApp"].set("load",!0);var e=$("#sendMoney_forma").serializeObject();if(e.recipient==MyProfile.webtransfer_id){var t={from_card_id:e.from_card,to_user_id:e.recipient,to_card_id:e.to_card,summ:e.ammount};"id"==t.to_user_id&&(t.to_user_id=e.user_id),API("transfer_to_card",t,function(e){return Messenger.finance.update(),ractiveComponent["wtc-SendmoneyApp"].set("load",!1),e.error?"003"==e.code||"Invalid code. Error: Wrong code. Please, try again."==e.error?noty({text:_chat_e("Ошибка безопасности")+" <br>"+_chat_e("Вы не прошли проверку двух-факторной авторизации!"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}):noty({text:_chat_e("Неизвестная ошибка данные  об ошибке:")+e.error,type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}):noty({text:_chat_e("Успешно!")+"<br>"+_chat_e("Перевод отправлен."),type:"success",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})},!0)}else{if(e.ammount<5)return noty({text:_chat_e("Минимальная сумма: ")+5+" USD",type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}),ractiveComponent["wtc-SendmoneyApp"].set("load",!1),!1;secure(_chat_e("Перевод личных средств")+"",function(t){var n={from_card_id:e.from_card,to_user_id:e.recipient,to_card_id:e.to_card,summ:e.ammount,purpose:t.type,code:t.code};"id"==n.to_user_id&&(n.to_user_id=e.user_id),API("transfer_to_card",n,function(e){return Messenger.finance.update(),ractiveComponent["wtc-SendmoneyApp"].set("load",!1),e.error?"003"==e.code||"Invalid code. Error: Wrong code. Please, try again."==e.error?noty({text:_chat_e("Ошибка безопасности")+" <br>"+_chat_e("Вы не прошли проверку двух-факторной авторизации!"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}):noty({text:_chat_e("Неизвестная ошибка данные  об ошибке:")+e.error,type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}}):noty({text:_chat_e("Успешно!")+"<br>"+_chat_e("Перевод отправлен."),type:"success",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})},!0)},function(){return ractiveComponent["wtc-SendmoneyApp"].set("load",!1),noty({text:_chat_e("Ошибка безопасности")+" <br>"+_chat_e("Вы не прошли проверку двух-факторной авторизации! (err_type_secure)"),type:"error",theme:"metroui",layout:"topCenter",timeout:4e3,progressBar:!0,animation:{open:"animated fadeInDown",close:"animated fadeOutUp"}})})}}),ractiveComponent["wtc-SendmoneyApp"].observe("scanUserByID",function(e){e&&e.user&&(select_user_send_money(e.user.webtransfer_id),ractiveComponent["wtc-SendmoneyApp"].set("byUserId",!0),ractiveComponent["wtc-SendmoneyApp"].set("scanUserByID_status_list","err"))});